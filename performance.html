<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.3 at Jul 2, 2012 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Java JMS Stock Brokers - Performance</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20120702" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Java JMS Stock Brokers
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
            
                <div class="xleft">
        <span id="publishDate">Last Published: 2012-07-02</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0-SNAPSHOT</span>
                      </div>
            <div class="xright">        
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
            
                                          <h5>Project Specification</h5>
                  <ul>
                  <li class="none">
                          <a href="requirements.html" title="Requirements">Requirements</a>
            </li>
                  <li class="none">
                          <a href="use-cases.html" title="Use Cases">Use Cases</a>
            </li>
                                                                                <li class="expanded">
                          <a href="architecture.html" title="Architecture">Architecture</a>
                    <ul>
                      <li class="none">
                          <a href="server-architecture.html" title="Stock Indices Server">Stock Indices Server</a>
            </li>
                      <li class="none">
                          <a href="client-architecture.html" title="Spring MVC Client">Spring MVC Client</a>
            </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="security.html" title="Security">Security</a>
            </li>
                  <li class="none">
            <strong>Performance</strong>
          </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="server/index.html" title="Stock Indices Server">Stock Indices Server</a>
            </li>
                  <li class="none">
                          <a href="client/index.html" title="Spring MVC Client">Spring MVC Client</a>
            </li>
          </ul>
                       <h5>Team Meetings</h5>
                  <ul>
                  <li class="none">
                          <a href="https://github.com/gosia-wielgus/jms-brokers/downloads" class="externalLink" title="Minutes">Minutes</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
            
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Performance tuning report<a name="Performance_tuning_report"></a></h2><div class="section"><h3>Test design<a name="Test_design"></a></h3><p>In making the right decision about tuning the application performance it is important first to define the usage scenarios in which the program will be intensively exercised. Then through measurements the baseline performance is created against which any tuning efforts are checked. </p><p>The JMS broker system consists of a central server sending updates to many web applications, which then forward the messages through HTTP responses to web browsers. The server is responsible for communication with a varying number of clients, but it is not expected that there will be more than a handful connected at any given moment. The real load is taken by the web applications which have to endure constant polling for stock data from the web browsers. </p><p>A typical browser session consists of:</p><ul><li>A log in</li><li>A long session of viewing the stock data, which generates timed requests (every 1s) to retrieve stock data</li><li>A log out</li></ul><p>Polling requests are the most frequently issued and therefore important action. Therefore the test plan consists of:</p><ul><li>Showing the login screen (login.htm)</li><li>Logging in (j_spring_security_check)</li><li>Showing the index page (index.htm)</li><li>Polling for stock data 100 times (data.json)</li><li>Logging out (logout.htm)</li></ul><p>All of the different actions can be timed separately in a <a href="./files/data.jmx">JMeter test plan</a>.</p></div><div class="section"><h3>Measurements taken before tuning<a name="Measurements_taken_before_tuning"></a></h3><p>Measurements have been taken using 10 threads, each looped 20 times. Server-side was set up using apache proxy. CPU time was divided between jmeter and tomcat as 1:3. Kernel time and apache time were neglible. The test machine was a laptop, so the results were dependent on the CPU temperature. The measurements represent the best attempt to use steady test conditions w.r.t. temperature and server steady state (done by running whole test twice and discarding first run results.</p><table border="1" class="bodyTable"><tr class="a"><th align="left">Page name</th><td align="right">requests</td><th align="right">avg</th><th align="right">med</th><th align="right">90%</th><th align="right">min</th><th align="right">max</th></tr><tr class="b"><td align="left">login.htm</td><td align="right">200</td><td align="right">2</td><td align="right">2</td><td align="right">4</td><td align="right">1</td><td align="right">9</td></tr><tr class="a"><td align="left">j_spring_security_check</td><td align="right">200</td><td align="right">62</td><td align="right">59</td><td align="right">84</td><td align="right">24</td><td align="right">399</td></tr><tr class="b"><td align="left">index.htm</td><td align="right">200</td><td align="right">20</td><td align="right">18</td><td align="right">38</td><td align="right">3</td><td align="right">61</td></tr><tr class="a"><td align="left">data.json</td><td align="right">20000</td><td align="right">29</td><td align="right">28</td><td align="right">51</td><td align="right">2</td><td align="right">109</td></tr><tr class="b"><td align="left">logout.htm</td><td align="right">200</td><td align="right">4</td><td align="right">4</td><td align="right">7</td><td align="right">2</td><td align="right">10</td></tr></table></div></div><div class="section"><h2>Out of these the most important are:<a name="Out_of_these_the_most_important_are:"></a></h2><table border="1" class="bodyTable"><tr class="a"><th align="center">name</th><th align="right">avg(ms)</th></tr><tr class="b"><td align="center">j_spring_security_check</td><td align="right">62</td></tr><tr class="a"><td align="center">data.json</td><td align="right">29</td></tr></table><div class="section"><h3>Tuning<a name="Tuning"></a></h3><p>Tuning attempts comprised of:</p><ul><li>Setting JVM memory parameters to &quot;-server -Xms512m -Xmx512m -XX:NewSize=128m -XX:MaxNewSize=128m -XX:MaxTenuringThreshold=2 -XX:PermSize=64m -XX:MaxPermSize=128m&quot;, which made no difference in measurements</li><li>Setting up constant 10 threads in tomcat thread pool. This made no difference in measurements. Set up only minimal thread number to 10. This had no impact on performance.</li><li>Rewriting part of login code (password hash evaluation using optimized lookup table and not creating many one-use objects) and data.json code (reusing of a query). Login time shortened to around 50ms, data.json generation time remained the same.</li></ul><p>In general all but one attempt to tune the system did not result in improvements.</p></div><div class="section"><h3>Results<a name="Results"></a></h3><p>Overall timing improvements</p><table border="1" class="bodyTable"><tr class="a"><th align="center">name</th><th align="right">avg(ms) before</th><th align="right">avg(ms) after</th></tr><tr class="b"><td align="center">j_spring_security_check</td><td align="right">~60</td><td align="right">~50</td></tr><tr class="a"><td align="center">data.json</td><td align="right">~30</td><td align="right">~30</td></tr></table></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2012.
          All Rights Reserved.      
            
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
